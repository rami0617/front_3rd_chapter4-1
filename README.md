## 목차
- [배포 파이프라인](#배포-파이프라인)
- [github action](#github-action)
- [주요 링크](#주요-링크)
- [주요 개념](#주요-개념)
- [CDN과 성능최적화/성능개선 보고서](#cdn과-성능최적화)

## 배포 파이프라인

### 개요
![hanghae-plus (2)](https://github.com/user-attachments/assets/18695f1f-ccff-428d-9326-be4f9ce5ac4a)
1. 개발자는 개발이 완료된 코드를 main 브랜치에 푸시합니다.
2. github actions을 통해 Next.js의 빌드 산출물(.output)이 S3 버킷으로 업로드됩니다.
3. 업로드된 정적 산출물은 CloudFront를 통해 CDN으로 사용자에게 제공됩니다. 

## github action
1. main 브랜치에 코드가 푸시되면 트리거됩니다.
2. 저장소를 체크아웃합니다.
3. Node.js를 설치합니다.
4. 프로젝트 의존성을 설치합니다.
5. 프로젝트를 빌드합니다.
6. AWS 자격증명을 구성합니다.
7. 빌드된 정적 파일을 S3버킷에 동기화합니다.
8. CloudFront 캐시를 무효화합니다.

## 주요 링크

- S3 버킷 웹사이트 엔드포인트: http://hanghae-project.s3-website.ap-northeast-2.amazonaws.com/
- CloudFront 배포 도메인 이름: http://d1ujuut01ecq75.cloudfront.net

## 주요 개념

- GitHub Actions과 CI/CD 도구
  - CI/CD 도구 : github actions, jenkins, CircleCI 등
  - Github actions : github와 통합되어 있고 러닝커브가 낮은 편이며, 코드를 테스트하고 빌드하며, 배포 프로세스를 자동화 한다. 또한, 커밋, 풀리퀘스트, 머지, 태그 생성 등의 이벤트를 기반으로 동작한다.
- S3와 스토리지
  - 스토리지 : 데이터를 저장하고 관리하기 위한 시스템 또는 공간. 우리가 사용하는 S3는 객체 스토리지에 해당하며, 데이터를 객체 형태(파일 + 메타 데이터)로 저장한다. 
  - S3 : 객체 스토리지 서비스. 정적 웹 호스팅을 지원하며, IAM 정책, 버킷 정책 등을 통해 권한관리를 할 수 있고, 파일 변경 이력을 저장해 삭제나 수정된 파일을 복구할 수 있다.
- CloudFront와 CDN
  - CDN : 전 세계에 분산된 서버 네트워크를 통해 사용자에게 컨텐츠(이미지, 동영상, 정적 파일 등)를 빠르고 안정적이게 전달하는 기술. 사용자와 가까운 서버(엣지 서버)에 컨텐츠를 캐싱하여 지연시간을 줄이며, 서버 부하를 분산시켜 대규모 트래픽을 효율적으로 처리한다.
  - CloudFront : 글로벌 CDN 서비스. 정적 컨텐츠들을 엣지 서버에 케싱하며 S3, EC2, Lambda와 같은 AWS 서비스와 통합하여 컨텐츠를 빠르게 배포할 수 있다. HTTPS를 기본적으로 지원하고 캐시 불가능한 동적 컨텐츠(사용자별로 다른 데이터)도 최소한의 지연시간으로 제공한다.
- 캐시 무효화(Cache Invalidation)
  - 캐시 무효화는 어떤 시점에 동작하는가?
    - 명시적으로 캐시 무효화를 요청한 경우(명령어 ```aws cloudfront create-invalidation```)
    - 캐시 만료 시간에 따라 자동으로 동작(기본적으로 24시간으로 설정)
    - 파일변경으로 인해 ETag 또는 Last-Modified 헤더가 달라질때
    - CloudFront 배포 업데이트 시점
- Repository secret과 환경변수
  - 환경변수 : 실행환경에서 어플리케이션에서 전달되는 값으로 설정값, 경로 정보, 변수 등을 저장하는데 사용된다.
  - Repository secret : 민감한 데이터를 보호하기 위해 github actions와 같은 CI/CD도구에서 사용하는 보안 환경 변수이다. 주로 API 키, 클라우드 자격증명 등 민감한 정보를 저장한다.

## CDN과 성능최적화
### CDN 도입 전 vs 도입 후
1. 동영상을 적용했을 때
 <img width="1290" alt="image" src="https://github.com/user-attachments/assets/645ce111-3333-407d-b68e-379f0a468ba3">네트워크 탭에서 확인. 왼쪽이 S3로 배포했을 때, 오른쪽이 CloudFront로 배포했을때(CDN 적용).

   | 항목                     | S3 배포 결과             | CloudFront 배포 결과   | 차이점 및 분석                           |
   |--------------------------|--------------------------|-------------------------|------------------------------------------|
   | **네트워크 요청 수**     | 30건                    | 27건                   | CloudFront가 요청을 최적화하여 중복된 요청 수를 줄임. |
   | **로드 타임 (Load Time)**| 6.36초                  | 6.04초                 | CloudFront가 약 **5% 빠른 로드 타임**을 제공. |
   | **DOMContentLoaded 시간**| 0.51초                  | 0.57초                 | CloudFront는 초기 캐싱 처리로 약간의 지연 발생. |
   | **비디오 파일 요청 시간**| 280ms (`mangom.mp4`)    | 56ms (`mangom.mp4`)    | CloudFront의 캐싱이 **80% 이상의 시간 단축**을 실현. |
   | **리소스 캐싱**          | 서버에서 직접 응답       | 대부분 `304 Not Modified` 응답 | CloudFront가 **엣지 서버 캐싱**을 통해 효율적인 응답 제공. |
   | **전송된 데이터 크기**   | 1.5MB                  | 1.47MB                | CloudFront는 압축 및 캐싱 최적화로 약간의 데이터 절감. |

---

-  추가 분석
    - **비디오 파일 처리 성능**: 비디오 파일의 요청 처리 시간이 CloudFront에서 크게 줄어들었으며, 이는 엣지 서버와 캐싱 덕분입니다.
    - **로드 타임 개선**: 전체 로드 타임에서 CloudFront는 캐싱 및 최적화된 네트워크 요청 구조로 인해 S3 대비 빠른 성능을 보였습니다.
    - **리소스 최적화**: CloudFront는 중복 요청을 줄이고, 캐싱된 리소스(`304 Not Modified`)를 적극적으로 활용하여 서버 부하를 감소시켰습니다.


2. 기본 Next.js 프로젝트
<img width="1108" alt="image" src="https://github.com/user-attachments/assets/484e731e-0e9d-409b-b3ec-05e2f551965a">
크롬 개발자도구 > 네트워크 탭에서 확인. 왼쪽이 S3로 배포했을 때, 오른쪽이 CloudFront로 배포했을때(CDN 적용).

| 측정 지표                | S3 결과    | CloudFront 결과 | 개선율           |
|--------------------------|------------|------------------|------------------|
| **페이지 로드 시간**      | 3초        | 1초              | **67% 개선**      |
| **TTFB(Time to First Byte)** | 1.5초      | 0.4초            | **73% 개선**      |
